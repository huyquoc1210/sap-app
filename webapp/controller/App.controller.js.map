{"version":3,"file":"App.controller.js","names":["BaseController","_interopRequireDefault","__BaseController","App","extend","onInit","_onInit","searchFilters","tabFilters","setModel","JSONModel","isMobile","browser","mobile","filterText","undefined","addTodo","_addTodo","model","getModel","todos","getProperty","map","todo","Object","assign","push","title","completed","setProperty","clearCompleted","_clearCompleted","i","length","splice","updateItemsLeftCount","_updateItemsLeftCount","itemsLeft","filter","onSearch","_onSearch","event","input","getSource","searchQuery","getValue","Filter","FilterOperator","Contains","_applyListFilters","onFilter","_onFilter","filterKey","getParameter","getKey","EQ","list","byId","binding","getBinding","concat","i18nKey","_this$getView","resourceModel","getView","resourceBundle","getResourceBundle","getText"],"sources":["../../src/controller/App.controller.ts"],"sourcesContent":["import browser from \"sap/ui/Device\";\nimport Filter from \"sap/ui/model/Filter\";\nimport FilterOperator from \"sap/ui/model/FilterOperator\";\nimport JSONModel from \"sap/ui/model/json/JSONModel\";\nimport UI5Event from \"sap/ui/base/Event\";\nimport BaseController from \"./BaseController\";\nimport ResourceModel from \"sap/ui/model/resource/ResourceModel\";\nimport ResourceBundle from \"sap/base/i18n/ResourceBundle\";\nimport ListBinding from \"sap/ui/model/ListBinding\";\nimport FilterType from \"sap/ui/model/FilterType\";\nimport Input from \"sap/m/Input\";\nimport List from \"sap/m/List\";\n\ntype Todo = {\n  title: string;\n  completed: boolean;\n};\n\n/**\n * @namespace sap.m.sample.TsTodos.webapp.controller\n */\nexport default class App extends BaseController {\n  searchFilters: Filter[];\n  tabFilters: Filter[];\n  searchQuery: string;\n  filterKey: \"active\" | \"completed\" | \"all\";\n\n  public onInit(): void {\n    this.searchFilters = [];\n    this.tabFilters = [];\n\n    this.setModel(\n      new JSONModel({\n        isMobile: browser.mobile,\n        filterText: undefined,\n      }),\n      \"view\"\n    );\n  }\n\n  /**\n   * Adds a new todo item to the bottom of the list.\n   */\n  public addTodo(): void {\n    const model = this.getModel();\n    const todos: Todo[] = model\n      .getProperty(\"/todos\")\n      .map((todo: Todo) => Object.assign({}, todo));\n\n    todos.push({\n      title: model.getProperty(\"/newTodo\"),\n      completed: false,\n    });\n\n    model.setProperty(\"/todos\", todos);\n    model.setProperty(\"/newTodo\", \"\");\n  }\n\n  /**\n   * Removes all completed items from the todo list.\n   */\n  public clearCompleted(): void {\n    const model = this.getModel();\n    const todos: Todo[] = model\n      .getProperty(\"/todos\")\n      .map((todo: Todo) => Object.assign({}, todo));\n\n    let i = todos.length;\n    while (i--) {\n      const todo = todos[i];\n      if (todo.completed) {\n        todos.splice(i, 1);\n      }\n    }\n\n    model.setProperty(\"/todos\", todos);\n  }\n\n  /**\n   * Updates the number of items not yet completed\n   */\n  public updateItemsLeftCount(): void {\n    const model = this.getModel();\n    const todos: Todo[] = model.getProperty(\"/todos\") || [];\n\n    const itemsLeft = todos.filter((todo: Todo) => !todo.completed).length;\n\n    model.setProperty(\"/itemsLeftCount\", itemsLeft);\n  }\n\n  /**\n   * Trigger search for specific items. The removal of items is disabled as long as the search is used.\n   * @param {UI5Event} event Input changed event\n   */\n  public onSearch(event: UI5Event) {\n    const model = this.getModel();\n    const input = event.getSource() as Input;\n\n    // First reset current filters\n    this.searchFilters = [];\n\n    // add filter for search\n    this.searchQuery = input.getValue();\n    if (this.searchQuery && this.searchQuery.length > 0) {\n      model.setProperty(\"/itemsRemovable\", false);\n      const filter = new Filter(\n        \"title\",\n        FilterOperator.Contains,\n        this.searchQuery\n      );\n      this.searchFilters.push(filter);\n    } else {\n      model.setProperty(\"/itemsRemovable\", true);\n    }\n\n    this._applyListFilters();\n  }\n\n  public onFilter(event: UI5Event) {\n    // First reset current filters\n    this.tabFilters = [];\n\n    // add filter for search\n    this.filterKey = event.getParameter(\"item\").getKey();\n\n    // eslint-disable-line default-case\n    switch (this.filterKey) {\n      case \"active\":\n        this.tabFilters.push(new Filter(\"completed\", FilterOperator.EQ, false));\n        break;\n      case \"completed\":\n        this.tabFilters.push(new Filter(\"completed\", FilterOperator.EQ, true));\n        break;\n      case \"all\":\n      default:\n      // Don't use any filter\n    }\n\n    this._applyListFilters();\n  }\n\n  public _applyListFilters(): void {\n    const list = this.byId(\"todoList\") as List;\n    const binding = list.getBinding(\"items\") as ListBinding;\n\n    binding.filter(\n      this.searchFilters.concat(this.tabFilters),\n      \"todos\" as FilterType\n    );\n\n    let i18nKey;\n    if (this.filterKey && this.filterKey !== \"all\") {\n      if (this.filterKey === \"active\") {\n        i18nKey = \"ACTIVE_ITEMS\";\n      } else {\n        // completed items: filterKey = \"completed\"\n        i18nKey = \"COMPLETED_ITEMS\";\n      }\n      if (this.searchQuery) {\n        i18nKey += \"_CONTAINING\";\n      }\n    } else if (this.searchQuery) {\n      i18nKey = \"ITEMS_CONTAINING\";\n    }\n\n    let filterText;\n    if (i18nKey) {\n      const resourceModel = this.getView()?.getModel(\"i18n\") as ResourceModel;\n      const resourceBundle =\n        resourceModel.getResourceBundle() as ResourceBundle;\n      filterText = resourceBundle.getText(i18nKey, [this.searchQuery]);\n    }\n\n    this.getModel(\"view\").setProperty(\"/filterText\", filterText);\n  }\n}\n"],"mappings":"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","ignoreList":[]}